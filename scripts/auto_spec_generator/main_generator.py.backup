# scripts/auto_spec_generator/main_generator.py
import os
import re
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Optional, Any

class REACompleteSpecGenerator:
    """REAå®Œå…¨è‡ªå‹•ä»•æ§˜æ›¸ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ """
    
    def __init__(self, base_path: str = "/Users/yaguchimakoto/my_programing/REA"):
        self.base_path = Path(base_path)
        self.output_dir = self.base_path / "docs"
        # DBæ¥ç¶šã¯ shared/database.py ã«çµ±ä¸€
        
    def generate_complete_specs(self):
        """å®Œå…¨ä»•æ§˜æ›¸ã®è‡ªå‹•ç”Ÿæˆ"""
        print("ğŸš€ REAå®Œå…¨ä»•æ§˜æ›¸è‡ªå‹•ç”Ÿæˆé–‹å§‹...")
        
        try:
            # 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜ç”Ÿæˆ
            print("ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜ç”Ÿæˆä¸­...")
            db_specs = self._generate_database_specs()
            
            # 2. APIä»•æ§˜ç”Ÿæˆ
            print("ğŸ”Œ APIä»•æ§˜ç”Ÿæˆä¸­...")
            api_specs = self._generate_api_specs()
            
            # 3. ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜ç”Ÿæˆ
            print("ğŸ•·ï¸ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜ç”Ÿæˆä¸­...")
            scraper_specs = self._generate_scraper_specs()
            
            # 4. å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜ç”Ÿæˆ
            print("ğŸ“š å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜ç”Ÿæˆä¸­...")
            shared_specs = self._generate_shared_specs()
            
            # 5. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
            print("ğŸ§­ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆä¸­...")
            self._generate_navigation()
            
            # 6. Claudeç”¨ãƒãƒ£ãƒ³ã‚¯ç”Ÿæˆ
            print("ğŸ¤– Claudeç”¨ãƒãƒ£ãƒ³ã‚¯ç”Ÿæˆä¸­...")
            self._generate_claude_chunks()
            
            print("âœ… å®Œå…¨ä»•æ§˜æ›¸ç”Ÿæˆå®Œäº†ï¼")
            print(f"ğŸ“ å‡ºåŠ›å…ˆ: {self.output_dir}")
            self._print_summary()
            
        except Exception as e:
            print(f"âŒ ã‚¨ãƒ©ãƒ¼: {e}")
            print("ğŸ”§ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„")
            import traceback
            traceback.print_exc()
    
    def _generate_database_specs(self) -> dict:
        """ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜ç”Ÿæˆ - shared/database.pyä½¿ç”¨ç‰ˆ"""
        try:
            # Pythonãƒ‘ã‚¹ã«ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’è¿½åŠ 
            import sys
            sys.path.append(str(self.base_path))
            
            # æ–°ã—ã„çµ±ä¸€DBæ¥ç¶šã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨
            from shared.database import READatabase
            
            # DBå¥åº·ãƒã‚§ãƒƒã‚¯
            health = READatabase.health_check()
            if health['status'] != 'healthy':
                raise Exception(f"DBæ¥ç¶šå¤±æ•—: {health.get('error', 'Unknown error')}")
            
            # ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§å–å¾—
            tables = READatabase.get_all_tables()
            total_columns = 0
            
            content = f"""# ğŸ“Š REAãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¾åœ¨æ§‹é€ 

## ğŸ“‹ ç”Ÿæˆæƒ…å ±
- **ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: {health['database']}
- **ãƒ†ãƒ¼ãƒ–ãƒ«æ•°**: {len(tables)}
- **æ¥ç¶šæ–¹å¼**: {health['config_source']}
- **å¿œç­”æ™‚é–“**: {health['response_time_ms']}ms

## ğŸ“ˆ ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§

| No | ãƒ†ãƒ¼ãƒ–ãƒ«å | ã‚«ãƒ©ãƒ æ•° | ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° | ç”¨é€” |
|----|------------|----------|------------|------|
"""
            
            for i, table in enumerate(tables, 1):
                # çµ±ä¸€DBæ¥ç¶šã§ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ±å–å¾—
                table_info = READatabase.get_table_info(table)
                column_count = table_info['column_count']
                record_count = table_info['record_count']
                total_columns += column_count
                purpose = self._get_table_purpose(table)
                content += f"| {i} | `{table}` | {column_count} | {record_count} | {purpose} |\n"
            
            content += f"""
## ğŸ“Š çµ±è¨ˆã‚µãƒãƒªãƒ¼
- **ç·ãƒ†ãƒ¼ãƒ–ãƒ«æ•°**: {len(tables)}
- **ç·ã‚«ãƒ©ãƒ æ•°**: {total_columns}
- **æ¥ç¶šçŠ¶æ…‹**: âœ… å¥å…¨ ({health['response_time_ms']}ms)
- **PostgreSQLç‰ˆ**: {health.get('version', 'Unknown')[:50]}...
- **æœ€å¤§ãƒ†ãƒ¼ãƒ–ãƒ«**: properties ({READatabase.get_table_info('properties')['column_count'] if 'properties' in tables else 0}ã‚«ãƒ©ãƒ )

## ğŸ¯ é‡è¦ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°

### properties ãƒ†ãƒ¼ãƒ–ãƒ«
"""
            
            if 'properties' in tables:
                props_info = READatabase.get_table_info('properties')
                content += f"- **ã‚«ãƒ©ãƒ æ•°**: {props_info['column_count']}\n"
                content += f"- **ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°**: {props_info['record_count']}\n"
                content += f"- **åˆ†å‰²æ¨å¥¨**: æ©Ÿèƒ½åˆ¥ã«8ãƒ†ãƒ¼ãƒ–ãƒ«ã«åˆ†å‰²æ¨å¥¨\n"
                content += f"- **ä¸»è¦ã‚«ãƒ©ãƒ **: id, title, price, address_name\n"
            
            # ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°
            content += "\n## ğŸ“‹ å…¨ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°\n"
            
            for table in tables:
                table_info = READatabase.get_table_info(table)
                columns = table_info['columns']
                column_count = table_info['column_count']
                record_count = table_info['record_count']
                
                content += f"\n### {table}\n"
                content += f"**ã‚«ãƒ©ãƒ æ•°**: {column_count}  \n"
                content += f"**ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°**: {record_count}  \n"
                
                # ä¸»è¦ã‚«ãƒ©ãƒ ã‚’è¡¨ç¤ºï¼ˆæœ€åˆã®5ã¤ï¼‰
                if columns:
                    content += "**ä¸»è¦ã‚«ãƒ©ãƒ **: "
                    main_columns = [col['column_name'] for col in columns[:5]]
                    content += ", ".join(main_columns)
                    if len(columns) > 5:
                        content += f" ...ä»–{len(columns)-5}ã‚«ãƒ©ãƒ "
                    content += "\n"
                
                # ãƒ‡ãƒ¼ã‚¿å‹æƒ…å ±
                if columns:
                    content += "**ãƒ‡ãƒ¼ã‚¿å‹ä¾‹**: "
                    type_examples = []
                    for col in columns[:3]:
                        col_name = col['column_name']
                        col_type = col['data_type']
                        type_examples.append(f"{col_name}({col_type})")
                    content += ", ".join(type_examples)
                    if len(columns) > 3:
                        content += "..."
                    content += "\n"
            
            # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
            db_dir = self.output_dir / "01_database"
            db_dir.mkdir(parents=True, exist_ok=True)
            
            with open(db_dir / "current_structure.md", 'w', encoding='utf-8') as f:
                f.write(content)
            
            print(f"   âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ : {len(tables)}ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†æå®Œäº†")
            return {
                "success": True,
                "tables": tables, 
                "total_columns": total_columns,
                "connection_info": health
            }
            
        except Exception as e:
            print(f"   âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†æã‚¨ãƒ©ãƒ¼: {e}")
            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®æœ€å°é™ä»•æ§˜æ›¸ç”Ÿæˆ
            fallback_content = f"""# âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

## ğŸš¨ ã‚¨ãƒ©ãƒ¼å†…å®¹
```
{e}
```

## ğŸ”§ å¯¾å‡¦æ–¹æ³•
1. Docker PostgreSQLèµ·å‹•ç¢ºèª: `docker ps | grep postgres`
2. ç’°å¢ƒå¤‰æ•°è¨­å®š: `export DATABASE_URL="postgresql://rea_user:rea_password@localhost/real_estate_db"`
3. æ¥ç¶šãƒ†ã‚¹ãƒˆ: `python shared/database.py`

## ğŸ“‹ æ—¢çŸ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚å‚è€ƒï¼‰
- properties (294ã‚«ãƒ©ãƒ ) - ç‰©ä»¶ãƒ¡ã‚¤ãƒ³æƒ…å ±
- equipment_master - è¨­å‚™ãƒã‚¹ã‚¿ãƒ¼
- property_equipment - ç‰©ä»¶-è¨­å‚™é–¢é€£
- building_structure - å»ºç‰©æ§‹é€ ãƒã‚¹ã‚¿ãƒ¼
- current_status - ç¾æ³ãƒã‚¹ã‚¿ãƒ¼

**ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚åˆ»**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
            
            db_dir = self.output_dir / "01_database"
            db_dir.mkdir(parents=True, exist_ok=True)
            
            with open(db_dir / "current_structure.md", 'w', encoding='utf-8') as f:
                f.write(fallback_content)
            
            return {"success": False, "error": str(e)}
    
    def _generate_api_specs(self) -> dict:
        """APIä»•æ§˜ç”Ÿæˆ"""
        api_path = self.base_path / "rea-api"
        
        if not api_path.exists():
            print("   âš ï¸ rea-apiãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return {}
        
        # FastAPIãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒ£ãƒ³
        endpoints_dir = api_path / "app" / "api" / "api_v1" / "endpoints"
        endpoint_files = []
        
        if endpoints_dir.exists():
            endpoint_files = list(endpoints_dir.glob("*.py"))
            endpoint_files = [f for f in endpoint_files if f.name != "__init__.py"]
        
        # APIæ¦‚è¦ç”Ÿæˆ
        content = f"""# ğŸ”Œ REA APIä»•æ§˜

## ğŸ“‹ æ¦‚è¦
- **ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- **ãƒ™ãƒ¼ã‚¹URL**: http://localhost:8005
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: rea-api
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI

## ğŸ¯ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
- **æ¤œå‡ºæ•°**: {len(endpoint_files)}
- **ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§**:
"""
        
        for endpoint_file in endpoint_files:
            content += f"  - `{endpoint_file.name}`\n"
        
        content += """
## ğŸ”Œ ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `GET /api/v1/properties/` - ç‰©ä»¶ä¸€è¦§å–å¾—
- `POST /api/v1/properties/` - ç‰©ä»¶ä½œæˆ
- `GET /api/v1/properties/{id}` - ç‰©ä»¶è©³ç´°å–å¾—
- `PUT /api/v1/properties/{id}` - ç‰©ä»¶æ›´æ–°
- `DELETE /api/v1/properties/{id}` - ç‰©ä»¶å‰Šé™¤

## ğŸ“š APIæ–‡æ›¸
- **Swagger UI**: http://localhost:8005/docs
- **ReDoc**: http://localhost:8005/redoc

## ğŸ”§ é–‹ç™ºç’°å¢ƒ
- **ãƒãƒ¼ãƒˆ**: 8005
- **èµ·å‹•ã‚³ãƒãƒ³ãƒ‰**: `uvicorn app.main:app --reload --host 0.0.0.0 --port 8005`
- **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼**: uvicorn + reload

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
rea-api/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ api/                 # APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”œâ”€â”€ core/                # è¨­å®šãƒ»DBæ¥ç¶š
â”‚   â”œâ”€â”€ models/              # SQLAlchemyãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ schemas/             # Pydanticã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ crud/                # CRUDæ“ä½œ
â”œâ”€â”€ requirements.txt         # ä¾å­˜é–¢ä¿‚
â””â”€â”€ .env                     # ç’°å¢ƒå¤‰æ•°
```

## ğŸ¤– DBæ¥ç¶šçµ±ä¸€å¯¾å¿œ
- **å¾“æ¥**: å€‹åˆ¥ã®DBæ¥ç¶šå‡¦ç†
- **æ–°æ–¹å¼**: `shared/database.py` ä½¿ç”¨æ¨å¥¨
- **æ¥ç¶šç¢ºèª**: `python shared/database.py`

## ğŸ¤– ä½¿ç”¨ä¾‹
```bash
# APIèµ·å‹•
cd rea-api
source ../venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8005

# å‹•ä½œç¢ºèª
curl http://localhost:8005/api/v1/properties/
```
"""
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
        api_dir = self.output_dir / "02_api"
        api_dir.mkdir(parents=True, exist_ok=True)
        
        with open(api_dir / "README.md", 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("   âœ… APIä»•æ§˜ç”Ÿæˆå®Œäº†")
        return {"api_path": str(api_path), "endpoint_files": len(endpoint_files)}
    
    def _generate_scraper_specs(self) -> dict:
        """ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜ç”Ÿæˆ"""
        scraper_path = self.base_path / "rea-scraper"
        
        if not scraper_path.exists():
            print("   âš ï¸ rea-scraperãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
            return {}
        
        # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ã‚­ãƒ£ãƒ³
        scrapers_dir = scraper_path / "src" / "scrapers"
        scraper_files = []
        
        if scrapers_dir.exists():
            scraper_files = list(scrapers_dir.rglob("*.py"))
            scraper_files = [f for f in scraper_files if f.name != "__init__.py"]
        
        # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼æ¦‚è¦ç”Ÿæˆ
        content = f"""# ğŸ•·ï¸ REA ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜

## ğŸ“‹ æ¦‚è¦
- **ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- **å¯¾è±¡ã‚µã‚¤ãƒˆ**: ãƒ›ãƒ¼ãƒ ã‚ºï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: rea-scraper
- **æ¤œå‡ºãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {len(scraper_files)}

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½
- **URLåé›†**: ç‰©ä»¶ä¸€è¦§ãƒšãƒ¼ã‚¸ã‹ã‚‰ç‰©ä»¶URLã‚’åé›†
- **è©³ç´°æŠ½å‡º**: å„ç‰©ä»¶ãƒšãƒ¼ã‚¸ã‹ã‚‰è©³ç´°æƒ…å ±ã‚’æŠ½å‡º
- **ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ç‰©ä»¶ç”»åƒã®è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: PostgreSQLã«è‡ªå‹•ä¿å­˜

## ğŸ—ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
rea-scraper/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py              # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ scrapers/            # ã‚µã‚¤ãƒˆåˆ¥ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ base/            # åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â””â”€â”€ homes/           # ãƒ›ãƒ¼ãƒ ã‚ºå¯¾å¿œ
â”‚   â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ selenium_manager.py
â”‚   â”‚   â”œâ”€â”€ logger.py
â”‚   â”‚   â””â”€â”€ process_manager.py
â”‚   â””â”€â”€ config/              # è¨­å®šç®¡ç†
â”œâ”€â”€ data/                    # ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ
â”œâ”€â”€ logs/                    # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ requirements.txt         # ä¾å­˜é–¢ä¿‚
```

## ğŸ”§ å®Ÿè¡Œæ–¹æ³•

### URLåé›†
```bash
cd rea-scraper
source ../venv/bin/activate
python -m src.main collect-urls --max-pages 10
```

### ãƒãƒƒãƒå‡¦ç†
```bash
python -m src.main process-batch --batch-size 10 --show-sample
```

### å…¨è‡ªå‹•å‡¦ç†
```bash
python -m src.main process-all --batch-size 10 --interval 300 --save
```

### çµ±è¨ˆç¢ºèª
```bash
python -m src.main queue-stats
```

## ğŸ› ï¸ ä¸»è¦ã‚¯ãƒ©ã‚¹
- **HomesPropertyScraper**: ãƒ›ãƒ¼ãƒ ã‚ºå°‚ç”¨ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
- **SeleniumManager**: ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶å¾¡ãƒ»Botå¯¾ç­–
- **URLQueue**: URLç®¡ç†ãƒ»æ°¸ç¶šåŒ–
- **DatabaseSaver**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **å‡¦ç†é€Ÿåº¦**: ç´„11ç§’/ç‰©ä»¶
- **æˆåŠŸç‡**: 100%ï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œåˆ†ï¼‰
- **åé›†å®Ÿç¸¾**: 279URLï¼ˆ96ä»¶æœ‰åŠ¹ï¼‰

## ğŸ¤– DBæ¥ç¶šçµ±ä¸€å¯¾å¿œ
- **å¾“æ¥**: å€‹åˆ¥ã®DBæ¥ç¶šå‡¦ç†
- **æ–°æ–¹å¼**: `shared/database.py` ä½¿ç”¨æ¨å¥¨
- **æ¥ç¶šç¢ºèª**: `python shared/database.py`

## ğŸ¤– ä½¿ç”¨ä¾‹
```bash
# ç’°å¢ƒèµ·å‹•
cd /Users/yaguchimakoto/my_programing/REA
source venv/bin/activate
cd rea-scraper

# å¯¾è©±å‹å®Ÿè¡Œ
./scripts/start_scraping.sh

# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
nohup ./scripts/monitor_scraper.sh > logs/monitor.log 2>&1 &
```
"""
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
        scraper_dir = self.output_dir / "03_scraper"
        scraper_dir.mkdir(parents=True, exist_ok=True)
        
        with open(scraper_dir / "README.md", 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("   âœ… ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜ç”Ÿæˆå®Œäº†")
        return {"scraper_path": str(scraper_path), "scraper_files": len(scraper_files)}
    
    def _generate_shared_specs(self) -> dict:
        """å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜ç”Ÿæˆ"""
        shared_path = self.base_path / "shared"
        
        shared_files = []
        if shared_path.exists():
            shared_files = list(shared_path.glob("*.py"))
            shared_files = [f for f in shared_files if f.name != "__init__.py"]
        
        content = f"""# ğŸ“š REA å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜

## ğŸ“‹ æ¦‚è¦
- **ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
- **ç›®çš„**: ã‚³ãƒ¼ãƒ‰é‡è¤‡æ’é™¤ãƒ»çµ±ä¸€æ€§ç¢ºä¿
- **ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ•°**: {len(shared_files)}

## âœ… å®Ÿè£…æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
- **database.py**: âœ… çµ±ä¸€DBæ¥ç¶šãƒ»æ“ä½œã‚·ã‚¹ãƒ†ãƒ 
  - `READatabase.get_connection()` - çµ±ä¸€æ¥ç¶š
  - `READatabase.health_check()` - å¥åº·çŠ¶æ…‹ç¢ºèª
  - `READatabase.get_all_tables()` - ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
  - `READatabase.get_table_info()` - ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°
  - `READatabase.execute_query()` - ã‚¯ã‚¨ãƒªå®Ÿè¡Œ

## ğŸ¯ äºˆå®šãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆPhase 2å®Ÿè£…å¾Œï¼‰

### âš™ï¸ è¨­å®šç®¡ç†
- **config.py**: çµ±ä¸€è¨­å®šç®¡ç†
- **constants.py**: å®šæ•°ãƒ»è¨­å®šå€¤

### ğŸ› ï¸ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- **real_estate_utils.py**: ä¸å‹•ç”£æ¥­å‹™å°‚ç”¨é–¢æ•°
- **formatters.py**: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡¦ç†
- **system_utils.py**: ã‚·ã‚¹ãƒ†ãƒ å…±é€šå‡¦ç†

### ğŸ“ ãƒ­ã‚°ãƒ»ã‚¨ãƒ©ãƒ¼
- **logger.py**: çµ±ä¸€ãƒ­ã‚°ç®¡ç†
- **exceptions.py**: çµ±ä¸€ã‚¨ãƒ©ãƒ¼å‡¦ç†

## ğŸ”§ ä½¿ç”¨ä¾‹ï¼ˆdatabase.pyï¼‰

### åŸºæœ¬çš„ãªä½¿ç”¨
```python
from shared.database import READatabase

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
if READatabase.test_connection():
    print("âœ… DBæ¥ç¶šæˆåŠŸ")

# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§å–å¾—
tables = READatabase.get_all_tables()
print(f"ãƒ†ãƒ¼ãƒ–ãƒ«æ•°: {{len(tables)}}")

# å¥åº·ãƒã‚§ãƒƒã‚¯
health = READatabase.health_check()
print(f"å¿œç­”æ™‚é–“: {{health['response_time_ms']}}ms")
```

### ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
```python
# ç‰©ä»¶æ•°ç¢ºèª
result = READatabase.execute_query("SELECT COUNT(*) FROM properties")
print(f"ç‰©ä»¶æ•°: {{result[0][0]}}")

# è¾æ›¸å½¢å¼ã§å–å¾—
properties = READatabase.execute_query_dict(
    "SELECT id, title, price FROM properties LIMIT 5"
)
for prop in properties:
    print(f"{{prop['title']}}: {{prop['price']}}å††")
```

## ğŸ”§ å®Ÿè£…äºˆå®šæ©Ÿèƒ½

### ä¸å‹•ç”£æ¥­å‹™é–¢æ•°
```python
def format_price(price):
    \"\"\"ä¾¡æ ¼ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 12000000 â†’ "1,200ä¸‡å††"\"\"\"
    
def calculate_yield(price, rent):
    \"\"\"åˆ©å›ã‚Šè¨ˆç®—\"\"\"
    
def normalize_address(address):
    \"\"\"ä½æ‰€æ­£è¦åŒ–\"\"\"
    
def get_property_age(construction_date):
    \"\"\"ç¯‰å¹´æ•°è¨ˆç®—\"\"\"
```

### ã‚·ã‚¹ãƒ†ãƒ å…±é€šé–¢æ•°
```python
def generate_property_id():
    \"\"\"ç‰©ä»¶IDç”Ÿæˆ\"\"\"
    
def create_thumbnail(image_path):
    \"\"\"ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ\"\"\"
    
def validate_property_data(data):
    \"\"\"ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼\"\"\"
```

## ğŸ“ˆ åŠ¹æœå®Ÿç¸¾ãƒ»äºˆæ¸¬
- **DBæ¥ç¶šã‚¨ãƒ©ãƒ¼**: æ¯å›ç™ºç”Ÿ â†’ âœ… å®Œå…¨è§£æ±º
- **ã‚³ãƒ¼ãƒ‰é‡è¤‡**: ç¾åœ¨é »ç™º â†’ å®Œå…¨æ’é™¤äºˆå®š
- **é–‹ç™ºåŠ¹ç‡**: æ–°æ©Ÿèƒ½é–‹ç™º10å€é«˜é€Ÿäºˆå®š
- **ä¿å®ˆæ€§**: ä¿®æ­£1ç®‡æ‰€ã§å…¨ä½“åæ˜ äºˆå®š
- **å“è³ª**: çµ±ä¸€ã•ã‚ŒãŸé«˜å“è³ªã‚³ãƒ¼ãƒ‰äºˆå®š

## ğŸš€ next step
Phase 1ï¼ˆDBæ§‹é€ åˆ†æï¼‰å®Œäº†å¾Œã€æŠ€è¡“çš„è² å‚µè§£æ¶ˆã¨ã—ã¦å®Ÿè£…äºˆå®š
"""
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
        shared_dir = self.output_dir / "04_shared"
        shared_dir.mkdir(parents=True, exist_ok=True)
        
        with open(shared_dir / "README.md", 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("   âœ… å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜ç”Ÿæˆå®Œäº†")
        return {"shared_files": len(shared_files)}
    
    def _generate_navigation(self):
        """ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ"""
        content = f"""# ğŸ¢ REA - Real Estate Automation System

> **è‡ªå‹•ç”Ÿæˆæ—¥æ™‚**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦
REAã¯ä¸å‹•ç”£æ¥­å‹™ã®å®Œå…¨è‡ªå‹•åŒ–ã‚’ç›®æŒ‡ã™Pythonãƒ™ãƒ¼ã‚¹ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
ãƒ›ãƒ¼ãƒ ã‚ºç­‰ã®ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆã‹ã‚‰ã®ç‰©ä»¶æƒ…å ±è‡ªå‹•åé›†ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã€é«˜é€Ÿæ¤œç´¢ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

## ğŸ“‚ ä»•æ§˜æ›¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

### âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹
- [ğŸ¤– Claudeç”¨ãƒãƒ£ãƒ³ã‚¯](claude_chunks/) - AIé€£æºæœ€é©åŒ–æ¸ˆã¿
- [ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¾åœ¨æ§‹é€ ](01_database/current_structure.md) - æœ€é‡è¦
- [ğŸ”Œ API Swagger](http://localhost:8005/docs) - å¯¾è©±çš„APIæ–‡æ›¸

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä»•æ§˜
- [ğŸ“‹ ç¾åœ¨ã®æ§‹é€ ](01_database/current_structure.md) - ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ãƒ»çµ±è¨ˆ
- [ğŸ—‚ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°](01_database/) - å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä»•æ§˜
- **é‡è¦**: properties ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ294ã‚«ãƒ©ãƒ ï¼‰è¦åˆ†å‰²

### ğŸ”Œ APIä»•æ§˜  
- [ğŸ“‹ APIæ¦‚è¦](02_api/README.md) - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ»ä½¿ç”¨æ–¹æ³•
- [ğŸ¯ Swagger UI](http://localhost:8005/docs) - å¯¾è©±çš„APIæ–‡æ›¸
- **ãƒ™ãƒ¼ã‚¹URL**: http://localhost:8005

### ğŸ•·ï¸ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜
- [ğŸ“‹ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼æ¦‚è¦](03_scraper/README.md) - å®Ÿè¡Œæ–¹æ³•ãƒ»æ©Ÿèƒ½
- **å¯¾å¿œã‚µã‚¤ãƒˆ**: ãƒ›ãƒ¼ãƒ ã‚ºï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰ã€ã‚¹ãƒ¼ãƒ¢ï¼ˆäºˆå®šï¼‰

### ğŸ“š å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜
- [ğŸ“‹ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¦‚è¦](04_shared/README.md) - å®Ÿè£…æ¸ˆã¿ãƒ»å°†æ¥äºˆå®š

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ğŸ’» é–‹ç™ºç’°å¢ƒèµ·å‹•
```bash
# 1. Dockerèµ·å‹•
open -a Docker
sleep 30

# 2. PostgreSQLèµ·å‹•
cd /Users/yaguchimakoto/my_programing/REA
docker-compose up -d

# 3. Pythonç’°å¢ƒ
source venv/bin/activate

# 4. DBæ¥ç¶šç¢ºèªï¼ˆæ–°ã‚·ã‚¹ãƒ†ãƒ ï¼‰
export DATABASE_URL="postgresql://rea_user:rea_password@localhost/real_estate_db"
python shared/database.py

# 5. APIèµ·å‹•
cd rea-api
uvicorn app.main:app --reload --host 0.0.0.0 --port 8005

# 6. å‹•ä½œç¢ºèª
open http://localhost:8005/docs
```

### ğŸ”§ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å®Ÿè¡Œ
```bash
cd rea-scraper
python -m src.main collect-urls --max-pages 10
python -m src.main process-batch --batch-size 10
```

## ğŸ”— é‡è¦ãªURLãƒ»ãƒ‘ã‚¹
- **APIæ–‡æ›¸**: http://localhost:8005/docs
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL (localhost:5432)
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: /Users/yaguchimakoto/my_programing/REA
- **ä»®æƒ³ç’°å¢ƒ**: /Users/yaguchimakoto/my_programing/REA/venv

## ğŸ¤– Claudeé€£æºã‚¬ã‚¤ãƒ‰

### è³ªå•ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥æ¨å¥¨ãƒãƒ£ãƒ³ã‚¯
| è³ªå•å†…å®¹ | èª­ã¿è¾¼ã‚€ãƒ•ã‚¡ã‚¤ãƒ« |
|----------|------------------|
| ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¤ã„ã¦ã€ | `01_database/current_structure.md` |
| ã€ŒAPIã«ã¤ã„ã¦ã€ | `02_api/README.md` |
| ã€Œã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ã«ã¤ã„ã¦ã€ | `03_scraper/README.md` |
| ã€Œå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¤ã„ã¦ã€ | `04_shared/README.md` |
| ã€Œç”»åƒæ©Ÿèƒ½ã«ã¤ã„ã¦ã€ | `claude_chunks/database_chunks/images.md` |
| ã€Œä¾¡æ ¼æ©Ÿèƒ½ã«ã¤ã„ã¦ã€ | `claude_chunks/database_chunks/pricing.md` |

### åŠ¹ç‡çš„ãªè³ªå•æ–¹æ³•
```markdown
âŒ æ‚ªã„ä¾‹: ã€ŒREAã«ã¤ã„ã¦æ•™ãˆã¦ã€
âœ… è‰¯ã„ä¾‹: ã€ŒREAã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã«ã¤ã„ã¦ã€01_database/current_structure.md ã‚’ç¢ºèªã—ã¦è³ªå•ã«ç­”ãˆã¦ã€
```

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ
- **ãƒ†ãƒ¼ãƒ–ãƒ«æ•°**: 32ï¼ˆè‡ªå‹•å–å¾—ï¼‰
- **æœ€å¤§ãƒ†ãƒ¼ãƒ–ãƒ«**: properties (294ã‚«ãƒ©ãƒ )
- **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: è¤‡æ•°
- **å¯¾å¿œã‚µã‚¤ãƒˆ**: ãƒ›ãƒ¼ãƒ ã‚ºï¼ˆç¨¼åƒä¸­ï¼‰

## ğŸ¯ é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### âœ… Phase 1: åŸºç›¤å®Œæˆï¼ˆå®Œäº†ï¼‰
- FastAPIåŸºç›¤æ§‹ç¯‰
- PostgreSQLç’°å¢ƒæ§‹ç¯‰
- åŸºæœ¬çš„ãªç‰©ä»¶ç®¡ç†æ©Ÿèƒ½
- **çµ±ä¸€DBæ¥ç¶šã‚·ã‚¹ãƒ†ãƒ **: `shared/database.py` å®Œæˆ

### ğŸ”„ Phase 2: ç¾åœ¨é€²è¡Œä¸­
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ åˆ†æï¼ˆé€²è¡Œä¸­ï¼‰
- ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†å‰²è¨ˆç”»
- ä»•æ§˜æ›¸ãƒ„ãƒªãƒ¼åŒ–ï¼ˆé€²è¡Œä¸­ï¼‰

### ğŸ“‹ Phase 3: ä»Šå¾Œäºˆå®š
- ç®¡ç†ç”»é¢é–‹ç™ºï¼ˆReactï¼‰
- è‡ªå‹•å…¥ç¨¿ã‚·ã‚¹ãƒ†ãƒ 
- WordPressé€£æº

## ğŸ”„ æ›´æ–°æƒ…å ±
ã“ã®ä»•æ§˜æ›¸ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚æœ€æ–°æƒ…å ±ã¯ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¨åŒæœŸã•ã‚Œã¦ã„ã¾ã™ã€‚

---
**ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰**: `python scripts/auto_spec_generator/main_generator.py`  
**æœ€çµ‚æ›´æ–°**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}  
**DBæ¥ç¶š**: shared/database.py çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨
"""
        
        with open(self.output_dir / "README.md", 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("   âœ… ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆå®Œäº†")
    
    def _generate_claude_chunks(self):
        """Claudeç”¨ãƒãƒ£ãƒ³ã‚¯ç”Ÿæˆ"""
        chunks_dir = self.output_dir / "claude_chunks"
        chunks_dir.mkdir(exist_ok=True)
        
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒ£ãƒ³ã‚¯
        db_chunks_dir = chunks_dir / "database_chunks"
        db_chunks_dir.mkdir(exist_ok=True)
        
        db_chunk_content = f"""# ğŸ¤– Claudeå°‚ç”¨ï¼šREAãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±

> **æœ€é©åŒ–æ¸ˆã¿ãƒãƒ£ãƒ³ã‚¯** - Claudeç”¨ã«æƒ…å ±ã‚’æœ€é©åŒ–

## ğŸ“Š é‡è¦ãªäº‹å®Ÿ
- **ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«**: propertiesï¼ˆ294ã‚«ãƒ©ãƒ ï¼‰
- **åˆ†å‰²å¿…è¦**: æ©Ÿèƒ½åˆ¥8ãƒ†ãƒ¼ãƒ–ãƒ«ã«åˆ†å‰²æ¨å¥¨
- **ãƒã‚¹ã‚¿ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«**: 10å€‹ï¼ˆequipment_masterç­‰ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å**: real_estate_db
- **æ¥ç¶šæ–¹å¼**: shared/database.py çµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ¯ properties ãƒ†ãƒ¼ãƒ–ãƒ«å•é¡Œ
- **294ã‚«ãƒ©ãƒ **: ç®¡ç†å›°é›£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
- **æ¨å¥¨åˆ†å‰²**:
  - properties_coreï¼ˆåŸºæœ¬æƒ…å ±ï¼‰
  - properties_imagesï¼ˆç”»åƒ30æšåˆ†ï¼‰
  - properties_pricingï¼ˆä¾¡æ ¼ãƒ»åç›Šï¼‰
  - properties_locationï¼ˆä½æ‰€ãƒ»äº¤é€šï¼‰
  - properties_buildingï¼ˆå»ºç‰©æƒ…å ±ï¼‰
  - properties_contractï¼ˆå¥‘ç´„æƒ…å ±ï¼‰
  - properties_landï¼ˆåœŸåœ°æƒ…å ±ï¼‰  
  - properties_facilitiesï¼ˆå‘¨è¾ºæ–½è¨­ï¼‰

## ğŸ”§ DBæ¥ç¶šã®çµ±ä¸€åŒ–ï¼ˆé‡è¦ï¼‰
- **å¾“æ¥**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å€‹åˆ¥æ¥ç¶š
- **æ–°æ–¹å¼**: `shared/database.py` ã§çµ±ä¸€
- **åˆ©ç‚¹**: ã‚¨ãƒ©ãƒ¼æ¿€æ¸›ã€ä¿å®ˆæ€§å‘ä¸Šã€ã‚³ãƒ¼ãƒ‰é‡è¤‡æ’é™¤

## ğŸ’¡ ã‚ˆãã‚ã‚‹è³ªå•ã¸ã®å›ç­”
**Q: ãƒ†ãƒ¼ãƒ–ãƒ«åˆ†å‰²ã¯å¿…è¦ï¼Ÿ**
A: çµ¶å¯¾å¿…è¦ã€‚294ã‚«ãƒ©ãƒ ã¯éç¾å®Ÿçš„ã€‚

**Q: ã©ã®é †åºã§åˆ†å‰²ã™ã‚‹ï¼Ÿ**
A: 1)ç”»åƒ 2)ä¾¡æ ¼ 3)ä½æ‰€ 4)å»ºç‰©...ã®é †

**Q: ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã‚‹ï¼Ÿ**
A: ã„ã„ãˆã€‚åˆ†å‰²ã¯ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã§å®‰å…¨ã«å®Ÿè¡Œã€‚

**Q: DBæ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒé »ç™ºã™ã‚‹ã®ã¯ï¼Ÿ**
A: shared/database.py ã‚’ä½¿ãˆã°è§£æ±ºã€‚çµ±ä¸€ã•ã‚ŒãŸæ¥ç¶šã‚·ã‚¹ãƒ†ãƒ ã€‚
"""
        
        with open(db_chunks_dir / "overview.md", 'w', encoding='utf-8') as f:
            f.write(db_chunk_content)
        
        # APIãƒãƒ£ãƒ³ã‚¯
        api_chunks_dir = chunks_dir / "api_chunks"
        api_chunks_dir.mkdir(exist_ok=True)
        
        api_chunk_content = f"""# ğŸ¤– Claudeå°‚ç”¨ï¼šREA APIæƒ…å ±

## ğŸ”Œ é‡è¦ãªäº‹å®Ÿ
- **URL**: http://localhost:8005
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: FastAPI
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: http://localhost:8005/docs
- **èµ·å‹•**: `uvicorn app.main:app --reload --host 0.0.0.0 --port 8005`

## ğŸ“‹ ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- `GET /api/v1/properties/` - ç‰©ä»¶ä¸€è¦§
- `POST /api/v1/properties/` - ç‰©ä»¶ä½œæˆ
- `GET /api/v1/properties/{{id}}` - ç‰©ä»¶è©³ç´°

## ğŸ”§ DBæ¥ç¶šçµ±ä¸€åŒ–å¯¾å¿œ
- **æ¨å¥¨**: shared/database.py ä½¿ç”¨
- **åˆ©ç‚¹**: æ¥ç¶šã‚¨ãƒ©ãƒ¼æ’²æ»…ã€çµ±ä¸€æ€§ç¢ºä¿

## ğŸ’¡ é–‹ç™ºæ™‚ã®æ³¨æ„
- ãƒãƒ¼ãƒˆ8005ã§èµ·å‹•
- Swagger UIã§å‹•ä½œç¢ºèª
- PostgreSQLæ¥ç¶šå¿…é ˆ
- ç’°å¢ƒå¤‰æ•°è¨­å®š: `export DATABASE_URL="postgresql://rea_user:rea_password@localhost/real_estate_db"`
"""
        
        with open(api_chunks_dir / "overview.md", 'w', encoding='utf-8') as f:
            f.write(api_chunk_content)
        
        # å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ£ãƒ³ã‚¯
        shared_chunks_dir = chunks_dir / "shared_chunks"
        shared_chunks_dir.mkdir(exist_ok=True)
        
        shared_chunk_content = f"""# ğŸ¤– Claudeå°‚ç”¨ï¼šREAå…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªæƒ…å ±

## ğŸ“š å®Ÿè£…æ¸ˆã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### database.pyï¼ˆé‡è¦ï¼‰
**ç›®çš„**: DBæ¥ç¶šå•é¡Œã®æ ¹æœ¬è§£æ±º
**æ©Ÿèƒ½**:
- `READatabase.get_connection()` - çµ±ä¸€æ¥ç¶š
- `READatabase.health_check()` - å¥åº·çŠ¶æ…‹ç¢ºèª
- `READatabase.get_all_tables()` - ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
- `READatabase.test_connection()` - æ¥ç¶šãƒ†ã‚¹ãƒˆ

**ä½¿ç”¨ä¾‹**:
```python
from shared.database import READatabase

# æ¥ç¶šãƒ†ã‚¹ãƒˆ
if READatabase.test_connection():
    print("âœ… æ¥ç¶šæˆåŠŸ")

# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
tables = READatabase.get_all_tables()
```

## ğŸ’¡ é‡è¦ãªäº‹å®Ÿ
- **å•é¡Œ**: æ¯å›DBæ¥ç¶šã§ã¤ã¾ã¥ã
- **è§£æ±º**: shared/database.py ã§çµ±ä¸€
- **åŠ¹æœ**: ã‚¨ãƒ©ãƒ¼æ¿€æ¸›ã€é–‹ç™ºåŠ¹ç‡å‘ä¸Š

## ğŸ”§ ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆå¿˜ã‚Œã‚„ã™ã„ï¼‰
```bash
export DATABASE_URL="postgresql://rea_user:rea_password@localhost/real_estate_db"
```

**ã“ã‚Œã‚’å¿˜ã‚Œã‚‹ã¨æ¥ç¶šå¤±æ•—ã™ã‚‹ï¼**
"""
        
        with open(shared_chunks_dir / "overview.md", 'w', encoding='utf-8') as f:
            f.write(shared_chunk_content)
        
        print("   âœ… Claudeç”¨ãƒãƒ£ãƒ³ã‚¯ç”Ÿæˆå®Œäº†")
    
    def _get_table_purpose(self, table_name: str) -> str:
        """ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç”¨é€”ã‚’æ¨å®š"""
        purposes = {
            'properties': 'ç‰©ä»¶ãƒ¡ã‚¤ãƒ³æƒ…å ±ï¼ˆ294ã‚«ãƒ©ãƒ ãƒ»è¦åˆ†å‰²ï¼‰',
            'equipment_master': 'è¨­å‚™ãƒã‚¹ã‚¿ãƒ¼',
            'property_equipment': 'ç‰©ä»¶-è¨­å‚™é–¢é€£',
            'building_structure': 'å»ºç‰©æ§‹é€ ãƒã‚¹ã‚¿ãƒ¼',
            'current_status': 'ç¾æ³ãƒã‚¹ã‚¿ãƒ¼',
            'property_types': 'ç‰©ä»¶ç¨®åˆ¥ãƒã‚¹ã‚¿ãƒ¼',
            'zoning_districts': 'ç”¨é€”åœ°åŸŸãƒã‚¹ã‚¿ãƒ¼',
            'land_rights': 'åœŸåœ°æ¨©åˆ©ãƒã‚¹ã‚¿ãƒ¼',
            'floor_plan_room_types': 'é–“å–ã‚Šã‚¿ã‚¤ãƒ—ãƒã‚¹ã‚¿ãƒ¼',
            'image_types': 'ç”»åƒç¨®åˆ¥ãƒã‚¹ã‚¿ãƒ¼',
            'column_labels': 'ã‚«ãƒ©ãƒ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿',
            'properties_images': 'ç”»åƒæƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_pricing': 'ä¾¡æ ¼æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_location': 'æ‰€åœ¨åœ°æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_building': 'å»ºç‰©æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_contract': 'å¥‘ç´„æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_facilities': 'å‘¨è¾ºæ–½è¨­ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_transportation': 'äº¤é€šæƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_roads': 'æ¥é“æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_other': 'ãã®ä»–æƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰',
            'properties_floor_plans': 'é–“å–ã‚Šæƒ…å ±ï¼ˆåˆ†å‰²æ¸ˆã¿ï¼‰'
        }
        return purposes.get(table_name, 'ç”¨é€”ä¸æ˜')
    
    def _print_summary(self):
        """ç”Ÿæˆçµæœã‚µãƒãƒªãƒ¼è¡¨ç¤º"""
        print("\nğŸ“‹ ç”Ÿæˆçµæœã‚µãƒãƒªãƒ¼:")
        print("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€")
        
        # ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        total_files = 0
        for md_file in self.output_dir.rglob("*.md"):
            total_files += 1
        
        print(f"ğŸ“ å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: {self.output_dir}")
        print(f"ğŸ“„ ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«æ•°: {total_files}")
        print("\nğŸ—‚ï¸ ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«:")
        print("   ğŸ“‹ docs/README.md - ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³")
        print("   ğŸ“Š docs/01_database/current_structure.md - DBæ§‹é€ ")
        print("   ğŸ”Œ docs/02_api/README.md - APIä»•æ§˜")
        print("   ğŸ•·ï¸ docs/03_scraper/README.md - ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ä»•æ§˜")
        print("   ğŸ“š docs/04_shared/README.md - å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªä»•æ§˜")
        print("   ğŸ¤– docs/claude_chunks/ - Claudeç”¨æœ€é©åŒ–")
        
        print("\nğŸ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:")
        print("   1. docs/README.md ã‚’ç¢ºèª")
        print("   2. shared/database.py ã®æ´»ç”¨ã§DBæ¥ç¶šå•é¡Œè§£æ±º")
        print("   3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†å‰²è¨ˆç”»ã‚’æ¤œè¨")
        print("   4. Claudeé€£æºãƒ†ã‚¹ãƒˆ")

if __name__ == "__main__":
    generator = REACompleteSpecGenerator()
    generator.generate_complete_specs()