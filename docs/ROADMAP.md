# REA ロードマップ

## ビジョン

**日本一の不動産情報システムを目指す**

- マルチテナント対応（他社への販売を前提）
- ホームズ/SUUMO/athome等の複数ポータル連携
- メタデータ駆動による拡張性と保守性の両立

---

## 現在の状態

**最終更新**: 2025-12-10
**現在フェーズ**: フェーズ2（機能拡充）

---

## フェーズ1: 基盤構築 ✅ 完了

### インフラ
- [x] GitHub Codespaces移行（2025年9月11日〜10月13日）
- [x] Docker環境構築（PostgreSQL:5433, Redis:6379）
- [x] 環境変数の整理（20+ファイルでハードコードパス除去）
- [x] Claude Code移行（2025年12月10日）

### DB最適化
- [x] モノリシック構造から分散構造へ移行
  - Before: propertiesテーブル 294カラム
  - After: 5テーブル、44コアカラム（85%削減）
- [x] column_labelsテーブル構築（143カラム定義）
- [x] マスターデータテーブル整備（9テーブル）

### メタデータ駆動実証
- [x] 設備管理機能（amenitiesテーブル）
  - 14個のbooleanカラム追加
  - バックエンド0行、フロントエンド0行の変更で完全動作
  - 日本語ラベル自動生成確認

### UI
- [x] 5タブ構成完成
  - 基本情報 / 土地情報 / 建物情報 / 設備・アメニティ / 画像

---

## フェーズ2: 機能拡充 🔄 進行中

### マスターデータシステム ✅ 完了（2025-12-10）
- [x] マルチテナント対応マスターテーブル設計
  - master_categories（45カテゴリ）
  - master_options（267選択肢）
  - company_master_settings（会社別カスタマイズ）
  - portal_mappings（ポータル連携用）
- [x] ホームズCSV仕様書v4.3.2からENUM抽出・登録
  - 物件種別（63件）、建物構造（12件）、用途地域（14件）等
- [x] 将来の拡張性確保
  - SUUMO/athome追加対応可能
  - 会社別マスター設定可能

### ENUM値拡張 ✅ 完了
- [x] property_type の選択肢追加（63種類）
- [x] 各種ステータスENUMの整備（45カテゴリ）
- [ ] バリデーション強化

### フロントエンド改善
- [x] フォームのUX改善（入力欄を日本人向けに太く）
- [ ] エラーハンドリング強化
- [ ] レスポンシブ対応確認

### API開発
- [x] Properties CRUD基本実装
- [ ] 検索・フィルタリング強化
- [ ] ページネーション
- [ ] マスターデータAPI追加

### 設備管理テスト
- [ ] 保存機能の動作確認
- [ ] バリデーションテスト

---

## フェーズ3: マルチテナント化

### 地理データ自動取得システム 🆕
物件の住所から各種地理情報を自動取得し、DBに反映。**査定・重説に必要なデータを自動収集。**

---

#### Phase 1: 基盤（必須）

**1. 位置情報基盤**
- [ ] Google Maps JavaScript API導入
- [ ] 住所→緯度経度変換（Geocoding API）
- [ ] 地図上でのピン位置調整UI
- [ ] 地理院標高API連携（土地の高さ自動取得）

**2. 用途地域・法規制（国土数値情報 A29/A55）**
- [ ] 用途地域データ取得・PostGIS投入
- [ ] 緯度経度から用途地域自動判定
- [ ] 建ぺい率・容積率の自動取得
- [ ] 防火地域・準防火地域の自動取得
- [ ] 高度地区の自動取得

**3. 最寄駅（国土数値情報 N02）**
- [ ] 鉄道・駅データ取得・DB投入
- [ ] 緯度経度から最寄駅検索（距離計算）
- [ ] 複数駅（徒歩圏内）の自動取得
- [ ] 駅までの距離・徒歩分数自動計算
- [ ] 駅別乗降客数データ連携（S12）

**4. 学区情報（国土数値情報 A27/A32）**
- [ ] 小学校区データ取得・DB投入
- [ ] 中学校区データ取得・DB投入
- [ ] 緯度経度から学区自動判定
- [ ] 学校までの距離自動計算

**5. ハザードマップ（国土数値情報 A31/A33/A40/A41）**
- [ ] 洪水浸水想定区域データ投入
- [ ] 土砂災害警戒区域データ投入
- [ ] 津波浸水想定データ投入
- [ ] 高潮浸水想定区域データ投入
- [ ] 緯度経度からリスク判定・自動表示

---

#### Phase 2: 価値向上

**6. 不動産情報ライブラリAPI（国交省）**
- [ ] API利用申請・キー取得
- [ ] 不動産取引価格情報の取得
- [ ] 地価公示・地価調査データ連携
- [ ] 周辺成約事例の自動表示

**7. 周辺施設距離（Google Places API / OpenStreetMap）**
- [ ] スーパーマーケット距離自動取得
- [ ] コンビニ距離自動取得
- [ ] ドラッグストア距離自動取得
- [ ] ホームセンター距離自動取得
- [ ] 病院・診療所距離自動取得（国土数値情報 P04併用）
- [ ] 銀行・ATM距離自動取得
- [ ] 公園距離自動取得

**8. 交通利便性（国土数値情報 P11/N07）**
- [ ] バス停留所データ投入
- [ ] バスルートデータ投入
- [ ] 最寄りバス停の自動取得

**9. 地価情報（国土数値情報 L01/L02）**
- [ ] 地価公示データ投入
- [ ] 都道府県地価調査データ投入
- [ ] 周辺地価の自動表示

---

#### Phase 3: 差別化（査定機能強化）

**10. 地盤・災害リスク詳細（地理院タイル）**
- [ ] 土地条件図の表示・保存
- [ ] 治水地形分類図の表示
- [ ] 活断層図の表示
- [ ] 地すべり地形分布図の表示
- [ ] 明治期の低湿地データ表示（地盤リスク）

**11. 土地履歴（地理院タイル）**
- [ ] 過去の空中写真取得・保存（1936年〜現在）
- [ ] 年代別比較表示機能
- [ ] 土地利用変遷の可視化

**12. 地図・画像の自動保存**
- [ ] 物件周辺地図画像の自動生成・保存
- [ ] ハザードマップ画像の自動保存
- [ ] 空中写真の自動保存
- [ ] 査定資料用PDF自動生成

---

#### データソース一覧

| データ | ソース | コード | コスト |
|--------|--------|--------|--------|
| 緯度経度 | Google Geocoding API | - | 有料（月$200無料枠） |
| 標高 | 地理院標高API | - | 無料 |
| 用途地域 | 国土数値情報 | A29 | 無料 |
| 都市計画決定情報 | 国土数値情報 | A55 | 無料 |
| 鉄道・駅 | 国土数値情報 | N02 | 無料 |
| 駅別乗降客数 | 国土数値情報 | S12 | 無料 |
| 小学校区 | 国土数値情報 | A27 | 無料 |
| 中学校区 | 国土数値情報 | A32 | 無料 |
| 洪水浸水想定 | 国土数値情報 | A31 | 無料 |
| 土砂災害警戒 | 国土数値情報 | A33 | 無料 |
| 津波浸水想定 | 国土数値情報 | A40 | 無料 |
| 高潮浸水想定 | 国土数値情報 | A41 | 無料 |
| 医療機関 | 国土数値情報 | P04 | 無料 |
| バス停留所 | 国土数値情報 | P11 | 無料 |
| 地価公示 | 国土数値情報 | L01 | 無料 |
| 地価調査 | 国土数値情報 | L02 | 無料 |
| 取引価格情報 | 不動産情報ライブラリAPI | - | 無料（申請制） |
| スーパー・コンビニ等 | Google Places API | - | 有料（月$200無料枠） |
| スーパー・コンビニ等 | OpenStreetMap (Overpass API) | - | 無料 |
| 地図タイル | 地理院タイル | - | 無料 |
| 空中写真 | 地理院タイル | - | 無料 |
| 土地条件図 | 地理院タイル | - | 無料 |

---

#### 技術スタック

| 用途 | 技術 |
|------|------|
| 空間DB | PostGIS（PostgreSQL拡張） |
| 地図表示 | Leaflet.js + 地理院タイル |
| 空間検索 | ST_Contains, ST_Distance等 |
| データ形式 | GeoJSON / Shapefile |
| API通信 | Python requests / axios |

### 自動計算・業務自動化 🆕

#### 価格・費用の自動計算
- [ ] 坪単価自動計算（sale_price ÷ land_area × 0.3025）
- [ ] 仲介手数料自動計算（価格×3%+6万円）
- [ ] 表面利回り自動計算
- [ ] 月額ランニングコスト合計表示

#### 日付・期限の自動管理
- [ ] 築年数自動計算（construction_dateから）
- [ ] 媒介契約更新アラート（3ヶ月前通知）
- [ ] 掲載確認日自動算出（専任:2週/一般:なし）
- [ ] 物件鮮度管理（掲載開始からの経過日数）

#### ワークフロー自動化
- [ ] 成約時の自動掲載停止
- [ ] 価格変更時のポータル自動更新通知
- [ ] レインズ登録リマインダー

#### バリデーション自動化
- [ ] 建ぺい率/容積率の妥当性チェック（用途地域上限）
- [ ] 専有面積 ≤ 延床面積チェック
- [ ] 所在階 ≤ 地上階数チェック

#### 画像処理
- [ ] アップロード時の自動リサイズ・最適化
- [ ] EXIF情報から撮影日取得

### 会社管理
- [ ] companiesテーブル作成
- [ ] 会社別認証・認可
- [ ] 会社別マスター設定UI

### ポータル連携
- [ ] ホームズCSV出力機能
- [ ] SUUMO連携対応
- [ ] athome連携対応
- [ ] portal_mappingsを使ったコード変換

### データ連携
- [ ] CSV/Excelインポート
- [ ] 既存データ移行ツール

---

## フェーズ4: 本番準備

### テスト
- [ ] ユニットテスト
- [ ] E2Eテスト
- [ ] パフォーマンステスト

### デプロイ
- [ ] 本番環境構築
- [ ] CI/CD設定
- [ ] 監視設定

---

## フェーズ5: 他社販売

### SaaS化
- [ ] サブスクリプション課金
- [ ] プラン別機能制限
- [ ] オンボーディングフロー

### 営業・サポート
- [ ] デモ環境
- [ ] ドキュメント整備
- [ ] サポート体制構築

---

## 技術的負債・メモ

- Tailwindのレスポンシブが効かない箇所あり → インラインstyleで対応中
- 実データ未投入（マスターデータのみ）
- テストコード未整備

---

## コードベース統計（2025年12月時点）

| 指標 | 数値 |
|------|------|
| 総ファイル数 | 212 |
| 総行数 | 13,371 |
| 総関数数 | 372 |
| 総クラス数 | 58 |

### マスターデータ統計

| テーブル | 件数 |
|---------|------|
| master_categories | 45 |
| master_options | 267 |
| column_labels | 143 |
