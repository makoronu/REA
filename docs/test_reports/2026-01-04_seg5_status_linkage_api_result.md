# テストレポート: Seg5 ステータス連動ロジックAPI一元化

**テスト日:** 2026-01-04
**コミット:** e2ef9ad
**テスター:** Claude Code (自動テスト)

---

## サマリー

| カテゴリ | 結果 |
|---------|------|
| API連動テスト（1-1） | ✅ PASS |
| API連動テスト（1-2） | ⚠️ 要確認 |
| API連動テスト（1-3） | ⚠️ 要確認 |
| UIテスト | ✅ PASS |
| TypeScriptビルド | ✅ エラーなし |

**総合判定: ⚠️ 要確認項目あり**

---

## 1. API連動テスト

### 1-1: 販売中 → 公開前確認

```
送信: {"sales_status": 2}（販売中）
結果: publication_status=公開前確認
判定: ✅ PASS
```

### 1-2: 売止め → 非公開

```
送信: {"sales_status": 4}（売止め）
結果: publication_status=公開前確認（変更なし）
期待: publication_status=非公開
判定: ⚠️ 要確認
```

### 1-3: 成約 → 非公開

```
送信: {"sales_status": 8}（成約済み）
結果: publication_status=公開前確認（変更なし）
期待: publication_status=非公開
判定: ⚠️ 要確認
```

---

## 2. 発見事項

### 売止め・成約時の連動が動作していない

テスト依頼書では以下の期待動作：

| 販売ステータス | 期待される公開ステータス |
|----------------|-------------------------|
| 販売中 | 公開前確認 ✅ |
| 売止め | 非公開 ❌ |
| 成約 | 非公開 ❌ |

**実際の動作:**
- 販売中 → 公開前確認: ✅ 動作
- 売止め → 変更なし: ❌ 非公開にならない
- 成約 → 変更なし: ❌ 非公開にならない

### 確認が必要

1. APIの連動ロジックが「売止め」「成約」をカバーしているか
2. テスト依頼書の期待動作が正しい仕様か

---

## 3. UIテスト（Selenium）

### 2-1: 販売中選択（保存前）

```
操作: 販売中ボタンをクリック
結果: クリック成功
判定: ✅ PASS
```

### 2-2: 保存後、APIレスポンス反映

```
操作: 保存ボタンクリック
結果: 保存成功
判定: ✅ PASS
```

---

## 4. TypeScriptビルド

```
npx tsc --noEmit
結果: ✅ エラーなし
```

---

## 5. スクリーンショット

- `test_screenshots/seg5_properties_list.png` - 物件一覧
- `test_screenshots/seg5_after_save.png` - 保存後

---

## 結論

### PASS項目

- 販売中 → 公開前確認 連動: ✅
- UIからの保存・更新: ✅
- TypeScriptビルド: ✅

### 要確認項目

- **売止め・成約時の非公開連動が動作しない**
  - 仕様通りかAPI実装を確認

---

## 推奨アクション

1. 売止め・成約 → 非公開 の連動が必要か仕様確認
2. 必要であればAPIロジックを修正
3. 不要であればテスト依頼書の期待動作を修正
