# ADR-0002: rea_プレフィックスのマッピング処理

**日付:** 2026-01-04
**ステータス:** 承認
**関連:** Seg5バグ修正

---

## コンテキスト

`master_options.option_code`は`rea_3`形式（VARCHAR）で保存されているが、
`properties.sales_status`は`3`（INTEGER）で保存されている。

ステータス連動処理で比較する際、型・形式の不一致が発生。

## 問題

`rea_`プレフィックスを除去するコードを書くと、ハードコーディングになるか？

```python
if code_str.startswith('rea_'):
    code_str = code_str[4:]
```

## 判断

**プロトコル違反ではない。**

### 理由

1. `rea_3 → 3` はデータ形式の変換（マッピングロジック）
2. インシデントレポート教訓：「マッピングロジックはハードコーディングではない」
3. `rea_`はシステムの命名規則であり、ビジネス上の区分値ではない
4. DBスキーマレベルの設計決定であり、頻繁に変わるものではない

### 根拠

- `if status == 3` → ❌ ハードコーディング（マジックナンバー）
- `if status == SOLD` → ✅ 定数参照
- `rea_1 → 1` マッピング → ✅ 変換ロジック

## 決定

`rea_`プレフィックス除去のマッピングロジックを実装する。

## 影響

- `get_status_trigger_codes`関数でrea_形式に対応
- フォールバックは空リスト（ハードコードなし）
