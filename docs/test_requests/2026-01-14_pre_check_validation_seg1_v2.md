# テスト依頼書: 公開前確認自動バリデーション（Seg1 v2）

## 作成日
2026-01-14

## 概要
公開前確認ステータス時の自動バリデーション表示 + バリデーションエラー時のステータス自動戻し

---

## 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `rea-admin/src/components/form/DynamicForm.tsx` | 初期バリデーション + ステータス戻し |

---

## 技術的変更点

- `api.get()` 使用（認証ヘッダー自動付与）
- `form.watch('publication_status')` で個別フィールドをwatch（無限ループ防止）
- `useRef` を条件付きリターンの**前**に配置（Hooksルール遵守）

---

## 前回からの修正点

| 問題 | 原因 | 修正 |
|------|------|------|
| React error #310 | useRefを条件付きリターン後に配置 | 条件付きリターン前に移動 |
| 401 Unauthorized | fetchを使用（認証なし） | api.get()に変更 |

---

## テスト項目

### 正常系

| # | テスト内容 | 期待結果 | 確認 |
|---|----------|---------|------|
| 1 | 公開前確認ステータスの物件を編集画面で開く | バリデーションエラーが自動表示される | [ ] |
| 2 | 必須項目が不足している状態で「公開」を選択 | バリデーションエラー表示 + ステータスが「公開前確認」に自動戻り | [ ] |
| 3 | 必須項目が不足している状態で「会員公開」を選択 | バリデーションエラー表示 + ステータスが「公開前確認」に自動戻り | [ ] |
| 4 | 全必須項目を入力後「公開」を選択 | バリデーション成功、ステータスが「公開」のまま | [ ] |

### 異常系（リグレッション）

| # | テスト内容 | 期待結果 | 確認 |
|---|----------|---------|------|
| 5 | 非公開ステータスの物件を開く | 自動バリデーションは実行されない | [ ] |
| 6 | 物件詳細画面が正常に表示される | エラーなしで表示 | [ ] |
| 7 | 物件編集画面でタブ切り替え | 正常に動作 | [ ] |
| 8 | 物件保存 | 正常に保存される | [ ] |

---

## テスト環境

- URL: https://realestateautomation.net/

## 備考

- v1からの修正版（Hooksルール違反と認証エラーを修正）
