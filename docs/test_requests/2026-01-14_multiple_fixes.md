# テスト依頼書: 複数バグ修正（2026-01-14）

## 作成日
2026-01-14

## 概要
3つのバグを修正：
1. 防火地域の重複表示解消
2. フィールド表示設定の空配列バリデーション削除
3. 設定項目（居住用/事業用/投資用）の「いずれか1つ必須」バリデーション追加

---

## 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `rea-admin/src/pages/admin/FieldVisibilityPage.tsx` | 空配列バリデーション削除 |
| `rea-api/app/services/publication_validator.py` | validation_group対応追加 |
| `scripts/migrations/fix_multiple_issues_20260114.sql` | DB設定変更 |

---

## テスト項目

### Seg1: 防火地域重複解消

| # | テスト内容 | 期待結果 | 確認 |
|---|----------|---------|------|
| 1 | 物件編集画面の「法令制限」タブを開く | 「防火地域」フィールドが表示される | [ ] |
| 2 | 物件編集画面の「土地情報」タブを開く | 「防火地域」フィールドが表示されない（以前は重複表示） | [ ] |

### Seg2: 空配列バリデーション削除

| # | テスト内容 | 期待結果 | 確認 |
|---|----------|---------|------|
| 3 | フィールド表示設定画面を開く | 正常に表示される | [ ] |
| 4 | あるフィールドの「無」ボタンをクリックして全物件種別をOFFにする | エラーなしで設定できる | [ ] |
| 5 | 保存ボタンをクリック | 「最低1つの物件種別を選択してください」エラーが出ずに保存成功 | [ ] |

### Seg3: 設定項目バリデーション

| # | テスト内容 | 期待結果 | 確認 |
|---|----------|---------|------|
| 6 | 物件編集画面の「物件種別」タブを開く | 「居住用」「事業用」「投資用」チェックボックスが表示される | [ ] |
| 7 | 全てのチェックを外した状態で公開ステータスを「公開」に変更 | バリデーションエラー：「「居住用」「事業用」「投資用」のいずれか」が必要 | [ ] |
| 8 | 「居住用」のみチェックして公開ステータスを「公開」に変更 | バリデーション成功 | [ ] |
| 9 | 「事業用」のみチェックして公開ステータスを「公開」に変更 | バリデーション成功 | [ ] |
| 10 | 「投資用」のみチェックして公開ステータスを「公開」に変更 | バリデーション成功 | [ ] |
| 11 | 複数チェック（居住用+投資用など）して公開に変更 | バリデーション成功 | [ ] |

---

## テスト環境

- URL: https://realestateautomation.net/
- フィールド表示設定: /admin/field-visibility

## 備考

- Seg1: `fire_prevention_district`を非表示（`visible_for = '{}'`）に設定
- Seg2: フィールドを完全に非表示にできるようになった
- Seg3: `validation_group`カラムを追加、同グループで「いずれか1つtrue」を要求
