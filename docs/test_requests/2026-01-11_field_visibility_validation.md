# テスト依頼書: フィールド表示設定バリデーション

## 作成日
2026-01-11

## 概要
フィールド表示設定画面で、フィールドを全物件種別から非表示にすることを防止するバリデーションを追加。

## 変更ファイル

| ファイル | 変更内容 |
|---------|---------|
| `rea-admin/src/pages/admin/FieldVisibilityPage.tsx` | handleSave関数に空配列チェック追加 |

## DB変更
なし

## テスト項目

### 1. 正常系

| No | 条件 | 期待結果 |
|----|------|---------|
| 1 | フィールドに1つ以上の物件種別を選択して保存 | 保存成功 |
| 2 | フィールドを全物件種別ON（null）で保存 | 保存成功 |
| 3 | 複数フィールドを同時に変更して保存 | 保存成功 |

### 2. 異常系

| No | 条件 | 期待結果 |
|----|------|---------|
| 1 | フィールドの「無」ボタンで全物件種別をOFFにして保存 | エラーメッセージ表示、保存されない |
| 2 | 複数フィールドのうち1つが全OFFで保存 | エラーメッセージ表示（該当フィールド名を表示）、保存されない |

### 3. UI確認

| No | 確認内容 | 期待結果 |
|----|---------|---------|
| 1 | エラーメッセージ表示 | 「「○○」は最低1つの物件種別を選択してください」と表示 |
| 2 | エラー後の動作 | 5秒後にメッセージが消える |
| 3 | エラー後の変更内容 | 変更内容は保持されたまま（再編集可能） |

## 攻撃ポイント

| ポイント | 確認内容 |
|---------|---------|
| 境界値 | 1つだけチェック→保存OK、0個チェック→保存NG |
| 設定タイプ切替 | 表示設定/公開時必須設定の両方で動作確認 |
| テーブル切替 | properties/building_info/land_info/amenitiesで動作確認 |

## テスト環境

- API: http://localhost:8005
- フロント: http://localhost:5173
- 管理画面: /admin/field-visibility

## テスト手順

1. 管理画面にログイン
2. フィールド設定ページを開く
3. 任意のフィールドの「無」ボタンをクリック（全物件種別OFF）
4. 保存ボタンをクリック
5. エラーメッセージが表示されることを確認
6. 1つ以上チェックを入れて保存ボタンをクリック
7. 保存成功することを確認

## 備考

- handleToggle（個別チェックボックス操作）は既存ロジックで全OFFにならない仕様のため、「無」ボタン経由のみが対象
