# テスト依頼書: 法令制限自動取得メタデータ駆動化

**作成日**: 2026-01-04
**対象コミット**: c962685
**優先度**: 高

---

## 概要

法令制限の自動取得機能をメタデータ駆動化。「自動取得」ボタンを押すと直接フォームに値が代入されるように変更。

---

## テスト対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `rea-api/app/api/api_v1/endpoints/reinfolib.py` | コード変換処理追加（+87行） |
| `rea-admin/src/components/form/RegulationTab.tsx` | 直接代入化、ハードコーディング削除（-157行） |

---

## テスト環境

```bash
# API起動
cd ~/my_programing/REA/rea-api && PYTHONPATH=~/my_programing/REA python -m uvicorn app.main:app --reload --port 8005

# フロント起動
cd ~/my_programing/REA/rea-admin && npm run dev
```

---

## テストケース

### 正常系

| # | 操作 | 期待結果 |
|---|------|---------|
| 1 | 物件編集画面 → 法令制限タブ → 「自動取得」ボタン押下 | 用途地域・建ぺい率・容積率がフォームに直接反映される |
| 2 | 美幌町の座標（lat=43.8333, lng=144.1）で自動取得 | 用途地域に「第二種中高層住居専用地域」が選択される |
| 3 | 自動取得後、保存ボタン押下 | 正常に保存される |
| 4 | 防火地域がある座標で自動取得 | 防火地域フィールドにも値が反映される |
| 5 | 地区計画がある座標で自動取得 | 地区計画名フィールドにも値が反映される |

### 異常系

| # | 操作 | 期待結果 |
|---|------|---------|
| 1 | 緯度経度なしで「自動取得」ボタン押下 | ボタンが無効化されている / エラーメッセージ表示 |
| 2 | 不正な座標（海上など）で自動取得 | 「該当データなし」メッセージ表示 |
| 3 | APIタイムアウト時 | エラーメッセージ表示 |

### 確認ポイント

| # | 確認項目 |
|---|---------|
| 1 | 「登録」ボタンが**削除されている**こと |
| 2 | プレビュー表示が**削除されている**こと |
| 3 | 用途地域が**複数選択**として正しく表示されること |
| 4 | 全角数字「第２種」が正しくコード変換されること |

---

## 攻撃ポイント

| カテゴリ | テスト内容 |
|---------|-----------|
| 境界値 | 日本の最北端・最南端の座標で自動取得 |
| 不正入力 | 文字列の緯度経度を入力してから自動取得 |
| レース条件 | 連続して自動取得ボタンを押下 |
| メタデータ | api_aliasesに登録されていない用途地域名が返された場合 |

---

## 確認完了チェックリスト

- [ ] 正常系 #1-5 全て合格
- [ ] 異常系 #1-3 全て合格
- [ ] 確認ポイント #1-4 全て合格
- [ ] 攻撃ポイントで問題なし

---

## 備考

- DBに`api_aliases`カラムを追加済み（本番反映はデプロイ時）
- 用途地域・防火地域のエイリアスはDBに登録済み
