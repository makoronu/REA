# テスト依頼書: Seg3b-3 月額費用 key_value型UI追加

**作成日**: 2026-01-16
**対象機能**: 月額費用フィールドのkey_value型エディタUI

---

## 1. 変更概要

月額費用（monthly_costs）フィールドに専用のキーバリューエディタUIを追加。
動的に項目名と金額を追加・編集・削除可能。

| 項目 | 内容 |
|------|------|
| 対象フィールド | monthly_costs（月額費用） |
| input_type | key_value |
| データ形式 | JSONB（例: `{"管理費": 10000, "修繕積立金": 5000}`） |

---

## 2. テスト対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `rea-admin/src/components/form/JsonEditors.tsx` | KeyValueEditorコンポーネント追加 |
| `rea-admin/src/components/form/FieldFactory.tsx` | key_valueケース追加 |

---

## 3. テストケース

### 3.1 表示確認

| No | 確認項目 | 期待結果 |
|----|----------|----------|
| 1 | 月額費用フィールドにエディタ表示 | キーバリュー形式のUI表示 |
| 2 | 既存データの読み込み | 保存済みデータが項目名・金額で表示 |

### 3.2 追加操作

| No | 操作 | 期待結果 |
|----|------|----------|
| 1 | 「＋ 項目を追加」クリック | 新規行追加（項目名・金額入力欄） |
| 2 | 項目名入力 | テキスト入力可能 |
| 3 | 金額入力 | 数値入力可能（「円」表示あり） |

### 3.3 削除操作

| No | 操作 | 期待結果 |
|----|------|----------|
| 1 | ✕ボタンクリック | 該当行削除 |
| 2 | ホバー時 | 赤色ハイライト |

### 3.4 保存確認

| No | 操作 | 期待結果 |
|----|------|----------|
| 1 | 項目追加→保存 | DB保存成功 |
| 2 | 再読み込み | 保存データが正しく表示 |
| 3 | 項目削除→保存 | 削除反映 |

### 3.5 バリデーション

| No | 入力 | 期待結果 |
|----|------|----------|
| 1 | 空の項目名 | 保存時に無視される |
| 2 | 数値以外の金額 | 無視される（数値のみ保存） |
| 3 | 全項目削除 | 空オブジェクト`{}`で保存 |

---

## 4. 確認手順

1. 管理画面にログイン
2. マンション物件を開く（月額費用フィールドあり）
3. 月額費用フィールドを探す
4. 上記テストケースを実行

---

## 5. 環境情報

- フロント: React + TypeScript
- コンポーネント: `KeyValueEditor`
- フィールド設定: column_labels.input_type = 'key_value'

---

## 6. 注意事項

- 月額費用フィールドはマンション物件で表示される
- 戸建て・土地では表示されない可能性あり（visible_for設定による）
- 既存データがある場合は上書き保存される

---

## 7. UIイメージ

```
┌─────────────────────────────────────────────┐
│ 月額費用                                     │
├─────────────────────────────────────────────┤
│ [管理費          ] [10000  円] [✕]          │
│ [修繕積立金       ] [5000   円] [✕]          │
│ [駐車場代        ] [15000  円] [✕]          │
│                                              │
│ [＋ 項目を追加]                              │
└─────────────────────────────────────────────┘
```
