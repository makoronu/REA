# テスト依頼書: Seg 17c-2 GeoPanelマップウィザード化

## 概要
GeoPanelを地図ベースの一括取得ウィザードに改修。
ボタン→地図表示→ピン指定→学区・駅・バス・施設を一括取得→結果確認→フォームに反映。

## 変更内容

### 変更ファイル（コミット: 64f2e2a）
- `GeoPanel.tsx`: 完全リライト（1278→592行、54%削減）
  - Leaflet地図+ドラッグ可能マーカー+クリックでピン操作
  - Promise.allSettledで4API同時呼び出し
  - 結果サマリー表示（学区候補選択可、駅・バス・施設は概要表示）
  - 「フォームに反映して閉じる」で全データをsetValue
- `constants.ts`: GEO_SEARCH_CONFIG.PROPERTY_BUS_STOPS.LIMIT追加

## テスト手順

### 1. GeoPanelモーダルの表示
- [ ] 物件編集画面→所在地・周辺情報タブ
- [ ] 「周辺情報を自動取得（学区・駅・バス・施設）」ボタンクリック
- [ ] モーダルが開き、Leaflet地図が表示される
- [ ] 座標がある物件の場合、地図にピンが表示される
- [ ] 座標がない物件の場合、東京付近がデフォルト表示される

### 2. 地図操作
- [ ] 地図をクリックするとピンが移動する
- [ ] ピンをドラッグして位置を変更できる
- [ ] ピン移動後、緯度・経度の表示が更新される

### 3. 一括取得
- [ ] 「📍 この位置で周辺情報を一括取得」ボタンクリック
- [ ] 取得中はスピナーが表示される
- [ ] 取得完了後、4セクションの結果が表示される:
  - 🏫 学区: 小学校・中学校の候補リスト（学区内は赤表示）
  - 🚃 最寄駅: 上位3件の駅名・路線・徒歩分数
  - 🚌 バス停: 上位5件のバス停名・徒歩分数
  - 🏪 周辺施設: カテゴリ別件数

### 4. 学区選択
- [ ] 学区候補をクリックすると選択状態になる（青枠）
- [ ] 学区内フラグがある学校は自動で選択される
- [ ] 別の候補をクリックすると選択が切り替わる

### 5. フォーム反映
- [ ] 「フォームに反映して閉じる」ボタンクリック
- [ ] モーダルが閉じる
- [ ] フォームの以下フィールドが更新される:
  - 緯度・経度
  - 小学校名・小学校徒歩分数
  - 中学校名・中学校徒歩分数
  - 交通情報（transportation JSON）
  - バス停情報（bus_stops JSON）
  - 周辺施設（nearby_facilities JSON）
- [ ] 保存ボタンで正常に保存できる

### 6. エラー時の動作
- [ ] 一部のAPIが失敗した場合、黄色警告で「○○の取得に失敗しました」表示
- [ ] 成功した項目は正常に結果表示される
- [ ] ピンを移動すると前回の結果がクリアされる

### 7. モーダル閉じる動作
- [ ] ×ボタンでモーダルが閉じる
- [ ] 「キャンセル」ボタンでモーダルが閉じる（フォームは変更されない）
- [ ] モーダル外（オーバーレイ）クリックでモーダルが閉じる

### 8. 既存機能への影響なし
- [ ] フォーム内のGeoフィールド（学区・駅・バス・施設）が表示されている
- [ ] 手動でのフィールド編集が可能
- [ ] 他タブ（基本情報・価格・管理・法令制限）が正常

## 確認ポイント
- GeoPanelで取得したデータがフォームに正しく反映されること
- 地図のピン操作がスムーズであること
- 一括取得の部分失敗が適切にハンドリングされること
- 法令制限タブのマップは独立して動作すること
