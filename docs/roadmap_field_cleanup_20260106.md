# フィールド整理・機能改善ロードマップ

**作成日**: 2026-01-06
**状態**: 計画中

---

## 概要

物件編集画面のフィールド整理、バグ修正、自動計算機能追加

---

## セグメント構成

### Seg1: バグ修正（本番環境）- 優先度: 高

| 項目 | 内容 | 状態 |
|------|------|------|
| 学校・バス停検索 | 本番DBにデータ投入 | ✅完了 |
| 中学校確定機能 | データ投入で自動有効化 | ✅完了 |

### Seg2: フィールド削除 - 優先度: 中

| グループ | 削除対象 | 状態 |
|----------|----------|------|
| 基本情報 | 物件名カナ、公開用物件名、外部物件ID、所属グループ、投資用物件 | ✅完了 |
| 契約条件 | 分配率、媒介契約日 | ✅完了 |
| 引渡・掲載 | 掲載開始日、掲載確認日 | ✅完了 |
| 元請会社 | 全削除（6件） | ✅完了 |
| 費用情報 | 駐車場使用料、住宅保険 | ✅完了 |
| 管理情報 | 社内担当者、社内メモ、優先度スコア、物件URL | ✅完了 |

### Seg3a: 自動計算機能 - 優先度: 中

| 項目 | 内容 | 状態 |
|------|------|------|
| 坪単価 | 価格÷土地面積(坪)で自動計算 | ✅完了 |
| 仲介手数料 | 空き家特例適用で自動計算（編集可能） | ✅完了 |

### Seg3b: 月額費用JSON化 - 優先度: 低

| 項目 | 内容 | 状態 |
|------|------|------|
| 月額費用 | 管理費・共益費等をJSON自由入力形式に変更 | 未着手 |

---

## 変更対象

- **DB**: column_labels テーブル（フィールド削除）
- **DB**: m_schools, m_bus_stops, m_school_districts（データ投入）
- **API**: 計算ロジック追加
- **フロント**: FieldFactory.tsx, DynamicForm.tsx

---

## 進捗

| 日時 | 内容 |
|------|------|
| 2026-01-06 | 計画作成、Seg1検討開始 |
| 2026-01-06 | Seg1完了: 本番DB地理データ投入 |
| 2026-01-07 | Seg2完了: 21フィールド非表示化 |
| 2026-01-07 | Seg3a完了: 坪単価・仲介手数料自動計算 |

### Seg3a 完了詳細

**実装内容**:
- 坪単価: sale_price ÷ land_area(坪) で自動計算
- 仲介手数料: 速算法+空き家特例（800万円以下は上限33万円）
- 定数: TAX_RATE, SQM_TO_TSUBO, AKIYA_SPECIAL_*

**コミット**: f8710d6

### Seg2 完了詳細

**非表示化フィールド**: 21件
**コミット**: b1129dc
**本番DB**: 適用済み

### Seg1 完了詳細

**投入データ**:
| テーブル | 件数 |
|----------|------|
| m_schools | 57,230件 |
| m_bus_stops | 278,515件 |
| m_school_districts（小学校） | 14,257件 |
| m_school_districts（中学校） | 7,445件 |

**コミット**: abce148
